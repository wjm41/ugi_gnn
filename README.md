# ugi_gnn

Using GNNs pretrained on docking scores to predict pIC50 for enrichment.

## Constrained docking of 1.7M Ugi library from Alpha Lee

### Manifest
* `total_ugi_library.csv` - the Ugi library (SMILES)
* `dock-all-chunks.sh` - LSF script to dock chunks of the library
* `dock-chunk.py` - Python script to dock single chunk
* `combine-chunks.py` - Python script to combine chunks (don't use this!)
* `convert-chunk.py` - Python script to convert `.oeb` docked chunk into `.sdf.bz2`
* `convert-all-chunks.py` - Python script to convert all chunks from `.oeb` in `output/` to `.sdf.bz2` in `docked/`
* `environment.yml` - Python conda environment
* `receptors/` - N0050 receptor generated by https://github.com/RobertArbon/fah_prep
  * `receptors/dimer/Mpro-N0050-protein.pdb` is the reference protein structure used for docking
  * `receptors/dimer/Mpro-N0050-ligand.mol2` is the reference ligand structure
* `output/` - docked chunks in `.oeb` format
* `docked/` - docked chunks in `.sdf.bz2` format

### Docking the library

```bash
# Create the environment
conda create -f environment.yml
# Activate it
conda activate perses-fah-0.8.1
# Dock all the chunks
bsub < dock-all-chunks.sh
# Combine chunks into huge SDF
python combine-chunks.py --chunkprefix=output/ugis-* --output=combined.sdf.gz
# Convert to smaller bz2 file
# TODO
```

### Methodology

The Fragalysis X-ray structure `P0030` was used for protein and ligand reference structure.
An OpenEye OEReceptor was generated using the OpenEye SpruceTK (as implemented in the [fah_prep](https://github.com/choderalab/fah_prep) pipeline) to prepare the un-aligned structure for docking, modeling the dimer with neutral catalytic dyad.
Next, the OpenEye toolkit was used to expand protonation states and tautomers, and then unspecified stereochemistry.
OpenEye Omega was used to expand conformers while holding the region of the virtual compound matching the SMARTS pattern `C(=O)NCC(=O)N` fixed to the reference ligand structure.
The resulting conformers were superimposed onto matching atoms of the reference compound in the reference receptor structure, and the top 10% of poses with shape overlap to the reference compound were retained.
The top score from the resulting poses, as determined by Chemgauss4 (which accounts for steric and other interactions), was selected as the top-scoring pose for that protonation, tautomeric, and stereoisomer state and written out.
The OpenEye Python Toolkit 2020.2.2 was used throughout.

